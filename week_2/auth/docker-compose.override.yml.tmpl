version: "3.9"

services:
  caddy:
    networks:
      - traefik-public
    labels:
      - traefik.enable=true
      - traefik.docker.network=traefik-public
      - traefik.http.routers.$APP_NAME.rule=Host(`$APP_NAME.localhost`)
      - traefik.http.routers.$APP_NAME.entryPoints=http
      - traefik.http.services.$APP_NAME.loadBalancer.server.port=80

  redis-commander:
    networks:
      - traefik-public
    labels:
      - traefik.enable=true
      - traefik.docker.network=traefik-public
      - traefik.http.routers.$APP_NAME-redis.rule=Host(`$APP_NAME-redis.localhost`)
      - traefik.http.routers.$APP_NAME-redis.entryPoints=http
      - traefik.http.services.$APP_NAME-redis.loadBalancer.server.port=8081

  php-fpm:
    networks:
        - services-proxy

networks:
  traefik-public:
    name: "traefik-public"
    external: true
  services-proxy:
    name: "services-proxy"
    external: true
    driver: bridge
